<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>PawPrints â€” Turn Your Pet Into a Keepsake</title>
    <meta name="description" content="Upload a photo of your pet and we'll turn them into a beautiful 3D-printed keepsake. Statues and keyrings.">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="/static/css/style.css">
    <!-- Firebase -->
    <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-auth-compat.js"></script>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/loaders/GLTFLoader.js"></script>
</head>
<body>

<!-- Nav -->
<nav class="nav">
    <div class="nav-left">
        <button class="nav-back" id="nav-back" onclick="goBack()" style="display:none;">â†</button>
        <a href="/" class="nav-logo">ğŸ¾ <span>Paw</span>Prints</a>
    </div>
    <div class="nav-right">
        <div class="nav-step" id="nav-step">Step 1 of 4</div>
        <div id="nav-auth"><button class="btn-sign-in" onclick="showSignIn()">Sign In</button></div>
    </div>
</nav>

<!-- Auth Modal -->
<div class="auth-modal" id="auth-modal">
    <div class="auth-card">
        <button class="auth-close" onclick="hideSignIn()">âœ•</button>
        <div class="auth-logo">ğŸ¾</div>
        <h2>Sign in to PawPrints</h2>
        <p>Save your keepsakes, track orders, and earn credits.</p>
        <button class="btn btn-google" onclick="signInWithGoogle()">
            <svg width="18" height="18" viewBox="0 0 18 18"><path fill="#4285F4" d="M17.64 9.2c0-.637-.057-1.251-.164-1.84H9v3.481h4.844c-.209 1.125-.843 2.078-1.796 2.717v2.258h2.908c1.702-1.567 2.684-3.875 2.684-6.615z"/><path fill="#34A853" d="M9 18c2.43 0 4.467-.806 5.956-2.18l-2.908-2.259c-.806.54-1.837.86-3.048.86-2.344 0-4.328-1.584-5.036-3.711H.957v2.332A8.997 8.997 0 0 0 9 18z"/><path fill="#FBBC05" d="M3.964 10.71A5.41 5.41 0 0 1 3.682 9c0-.593.102-1.17.282-1.71V4.958H.957A8.997 8.997 0 0 0 0 9c0 1.452.348 2.827.957 4.042l3.007-2.332z"/><path fill="#EA4335" d="M9 3.58c1.321 0 2.508.454 3.44 1.345l2.582-2.58C13.463.891 11.426 0 9 0A8.997 8.997 0 0 0 .957 4.958L3.964 7.29C4.672 5.163 6.656 3.58 9 3.58z"/></svg>
            Continue with Google
        </button>
        <div class="auth-divider"><span>coming soon</span></div>
        <button class="btn btn-secondary" disabled style="opacity:0.4;">Continue with Facebook</button>
        <button class="btn btn-secondary" disabled style="margin-top:8px;opacity:0.4;">Continue with X</button>
        <div class="auth-terms">By signing in you agree to our Terms of Service and Privacy Policy.</div>
    </div>
</div>

<!-- User Portal -->
<div class="portal-overlay" id="screen-portal">
    <div class="portal-panel">
        <div class="portal-header">
            <h2>My Account</h2>
            <button class="auth-close" onclick="hidePortal()">âœ•</button>
        </div>
        <div class="portal-user">
            <div class="portal-avatar" id="portal-avatar">ğŸ‘¤</div>
            <div><div class="portal-name" id="portal-name"></div><div class="portal-email" id="portal-email"></div></div>
        </div>
        <div class="config-card">
            <h3>âš¡ Credits</h3>
            <div class="credits-display"><span class="credits-count" id="portal-credits">3</span><span class="credits-label">3D generations remaining</span></div>
            <button class="btn btn-primary btn-sm" onclick="alert('Stripe checkout coming soon!')" style="margin-top:10px;">Buy More Credits</button>
        </div>
        <div class="config-card">
            <h3>ğŸ“¦ Delivery Details</h3>
            <div class="form-group"><label>Phone</label><input type="tel" id="profile-phone" placeholder="+61 400 000 000"></div>
            <div class="form-group"><label>Street Address</label><input type="text" id="profile-address" placeholder="123 Main Street"></div>
            <div class="form-row"><div class="form-group"><label>City</label><input type="text" id="profile-city" placeholder="Sydney"></div><div class="form-group"><label>State</label><input type="text" id="profile-state" placeholder="NSW"></div></div>
            <div class="form-row"><div class="form-group"><label>Postcode</label><input type="text" id="profile-postcode" placeholder="2000"></div><div class="form-group"><label>Country</label><select id="profile-country"><option value="AU" selected>Australia</option><option value="US">United States</option><option value="UK">United Kingdom</option><option value="NZ">New Zealand</option><option value="CA">Canada</option></select></div></div>
            <div class="form-group" style="margin-top:12px;"><label class="checkbox-label"><input type="checkbox" id="profile-marketing"> Send me updates about new products and offers</label></div>
            <button class="btn btn-accent btn-sm" onclick="saveUserProfile()" style="margin-top:12px;">Save Details</button>
        </div>
        <div class="config-card"><h3>ğŸ“‹ Order History</h3><div id="portal-orders"><div class="empty-state">No orders yet</div></div></div>
        <button class="btn btn-secondary" onclick="signOut()" style="margin-top:16px;">Sign Out</button>
    </div>
</div>

<!-- Step Dots -->
<div class="steps">
    <div class="step-dot active"></div>
    <div class="step-dot"></div>
    <div class="step-dot"></div>
    <div class="step-dot"></div>
</div>

<div class="container">

    <!-- â•â• SCREEN 1: Product Picker â•â• -->
    <div class="screen active" id="screen-upload">
        <div class="hero">
            <h1>Turn your pet into<br>a keepsake</h1>
            <p>Choose a custom 3D-printed keepsake of your furry friend</p>
        </div>

        <!-- Statue Card -->
        <div class="product-card" id="card-statue" onclick="selectProduct('statue')">
            <div class="product-card-header">
                <div>
                    <div class="product-card-title">Statue</div>
                    <div class="product-card-desc">Keepsake statue</div>
                </div>
                <div class="product-card-icon">ğŸ—¿</div>
            </div>
            <div class="product-upload-area" id="upload-statue" style="display:none;">
                <div class="upload-inner" onclick="event.stopPropagation();">
                    <div class="upload-prompt">
                        <span class="upload-icon">ğŸ“¸</span>
                        <span>Upload or take a photo</span>
                    </div>
                    <div class="upload-btns">
                        <button class="btn btn-primary btn-sm" onclick="triggerCamera('statue')">ğŸ“· Camera</button>
                        <button class="btn btn-secondary btn-sm" onclick="triggerGallery('statue')">ğŸ–¼ï¸ Gallery</button>
                    </div>
                    <div class="upload-preview" id="preview-statue" style="display:none;">
                        <img id="preview-img-statue" alt="Pet photo">
                        <button class="preview-remove" onclick="removePhoto('statue')">âœ•</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Keyring Card -->
        <div class="product-card" id="card-keyring" onclick="selectProduct('keyring')">
            <div class="product-card-header">
                <div>
                    <div class="product-card-title">Keyring</div>
                    <div class="product-card-desc">Mini charm keychain</div>
                </div>
                <div class="product-card-icon">ğŸ”‘</div>
            </div>
            <div class="product-upload-area" id="upload-keyring" style="display:none;">
                <div class="upload-inner" onclick="event.stopPropagation();">
                    <div class="upload-prompt">
                        <span class="upload-icon">ğŸ“¸</span>
                        <span>Upload or take a photo</span>
                    </div>
                    <div class="upload-btns">
                        <button class="btn btn-primary btn-sm" onclick="triggerCamera('keyring')">ğŸ“· Camera</button>
                        <button class="btn btn-secondary btn-sm" onclick="triggerGallery('keyring')">ğŸ–¼ï¸ Gallery</button>
                    </div>
                    <div class="upload-preview" id="preview-keyring" style="display:none;">
                        <img id="preview-img-keyring" alt="Pet photo">
                        <button class="preview-remove" onclick="removePhoto('keyring')">âœ•</button>
                    </div>
                </div>
            </div>
        </div>

        <input type="file" id="file-input" accept="image/*" hidden>
        <input type="file" id="camera-input" accept="image/*" capture="environment" hidden>

        <button class="btn btn-accent btn-lg" id="btn-continue-upload" onclick="startProcessing()" disabled>
            Continue â†’
        </button>
        <div class="secure-badge">ğŸ”’ Secure checkout</div>

        <a href="#" class="example-link">â†’ View example photos</a>

        <footer class="footer">
            ğŸ¾ PawPrints Â· Handcrafted in Australia
        </footer>
    </div>

    <!-- â•â• SCREEN 1.5: Approve Processed Image â•â• -->
    <div class="screen" id="screen-approve">
        <div class="hero">
            <h1>Looking good?</h1>
            <p>Reroll for free until you're happy. Bank your favourite to keep it safe while you explore.</p>
        </div>

        <!-- Current Roll -->
        <div class="approve-section">
            <div class="approve-label">Current Roll</div>
            <div class="preview-container" id="approve-preview">
                <img id="approve-img" alt="Processed pet image">
            </div>
            <div class="approve-actions">
                <button class="btn btn-primary btn-sm" onclick="bankCurrent()">â­ Bank this one</button>
                <button class="btn btn-secondary btn-sm" onclick="rerollGemini()">ğŸ”„ Reroll (free)</button>
            </div>
        </div>

        <!-- Banked Image -->
        <div class="approve-section" id="banked-section" style="display:none;">
            <div class="approve-label">â­ Banked <span class="banked-hint">â€” your saved favourite</span></div>
            <div class="preview-container banked" id="banked-preview">
                <img id="banked-img" alt="Banked image">
            </div>
            <button class="btn btn-secondary btn-sm" onclick="useBanked()" style="margin-top:8px;">Use banked image instead</button>
        </div>

        <!-- Approve Button -->
        <button class="btn btn-accent btn-lg" id="btn-approve" onclick="approveAndGenerate()" style="margin-top:16px;">
            âœ… Generate 3D Model
        </button>

        <button class="btn btn-secondary" onclick="showScreen('upload')" style="margin-top:10px;">
            â† Change Photo
        </button>

        <div class="secure-badge" style="margin-top:12px;">Rerolls are free Â· 3D generation uses 1 of <span id="approve-remaining">3</span> daily credits</div>
    </div>

    <!-- â•â• SCREEN 2: Customise â•â• -->
    <div class="screen" id="screen-customise">

        <!-- Product Label -->
        <div class="product-label" id="product-label">ğŸ—¿ Statue</div>

        <!-- 3D Viewer -->
        <div class="viewer-container" id="viewer-3d">
            <button class="viewer-reset" onclick="resetView()">Reset view</button>
            <button class="viewer-reroll" id="btn-reroll" onclick="rerollModel()">ğŸ”„ Regenerate (<span id="reroll-count">2</span> left)</button>
            <div class="viewer-hint">Drag to rotate Â· Pinch to zoom</div>
        </div>

        <!-- Size -->
        <div class="config-card" id="size-card">
            <h3>âœ¦ Size <span class="size-badge" id="size-badge">150mm</span></h3>
            <div class="size-presets" id="size-presets">
                <button class="preset-btn" data-size="100" onclick="setPreset(100)">Small<br><span>100mm</span></button>
                <button class="preset-btn active" data-size="150" onclick="setPreset(150)">Medium<br><span>150mm</span></button>
                <button class="preset-btn" data-size="260" onclick="setPreset(260)">Large<br><span>260mm</span></button>
            </div>
            <div class="size-control">
                <input type="range" id="size-slider" min="50" max="300" value="150" step="5">
                <div class="size-limits">
                    <span id="size-min-label">50mm</span>
                    <span id="size-max-label">300mm</span>
                </div>
                <div class="size-warning" id="size-warning"></div>
            </div>
        </div>

        <!-- Material -->
        <div class="config-card" id="material-card">
            <h3>ğŸ§± Material</h3>
            <div class="material-grid" id="material-grid"></div>
        </div>

        <!-- Colour -->
        <div class="config-card">
            <h3>ğŸ¨ Colour</h3>
            <div class="color-row" id="color-options"></div>
        </div>

        <!-- Finish -->
        <div class="config-card">
            <h3>âœ¨ Finish</h3>
            <div class="finish-row" id="finish-options"></div>
        </div>

        <button class="btn btn-accent btn-lg" id="btn-order" onclick="goToOrder()">
            Continue â†’
        </button>
        <div class="secure-badge">ğŸ”’ Secure checkout</div>
    </div>

    <!-- â•â• SCREEN 3: Order Review â•â• -->
    <div class="screen" id="screen-order">
        <div class="hero">
            <h1>Review Your Order</h1>
        </div>

        <!-- Captured 3D preview -->
        <div class="order-preview">
            <img id="order-preview-img" alt="Your configured keepsake">
        </div>

        <div class="quote-card">
            <div class="quote-label">Total price</div>
            <div class="quote-price" id="order-total-price">$124.06 AUD</div>
        </div>

        <!-- Colour (display) -->
        <div class="config-card">
            <h3>ğŸ¨ Colour</h3>
            <div class="color-row" id="order-color-display"></div>
        </div>

        <!-- Finish (display) -->
        <div class="config-card">
            <h3>âœ¨ Finish</h3>
            <div class="finish-row" id="order-finish-display"></div>
        </div>

        <div class="success-card" id="order-summary">
            <div class="row">
                <span class="label">Product</span>
                <span class="value" id="order-product">Statue</span>
            </div>
            <div class="row">
                <span class="label">Material</span>
                <span class="value" id="order-material">ABS Plastic</span>
            </div>
            <div class="row">
                <span class="label">Size</span>
                <span class="value" id="order-size">150mm</span>
            </div>
        </div>

        <button class="btn btn-accent btn-lg" onclick="placeOrder()">
            ğŸ›’ Place Order
        </button>
        <div class="secure-badge">ğŸ”’ Secure checkout</div>

        <button class="btn btn-secondary" onclick="showScreen('customise')" style="margin-top:10px;">
            â† Back to Customise
        </button>
    </div>

    <!-- â•â• SCREEN 4: Success â•â• -->
    <div class="screen" id="screen-success">
        <div class="success-icon">ğŸ‰</div>
        <div class="hero">
            <h1>Order Placed!</h1>
            <p>We'll start crafting your keepsake right away. You'll receive updates via email.</p>
        </div>

        <div class="success-card">
            <div class="row">
                <span class="label">Order ID</span>
                <span class="value" id="success-order-id">PP-XXXX</span>
            </div>
            <div class="row">
                <span class="label">Status</span>
                <span class="value">Processing</span>
            </div>
            <div class="row">
                <span class="label">Est. Delivery</span>
                <span class="value">2-3 weeks</span>
            </div>
        </div>

        <button class="btn btn-primary btn-lg" onclick="location.reload()">
            Create Another Keepsake
        </button>
    </div>

</div>

<!-- Processing Overlay -->
<div class="processing-overlay" id="processing-overlay">
    <div class="spinner"></div>
    <div class="processing-text" id="processing-text">Processing your photo...</div>
    <div class="processing-sub" id="processing-sub">This usually takes 2-4 minutes</div>
    <div class="progress-bar"><div class="progress-fill" id="progress-fill"></div></div>
</div>

<script src="/static/js/materials.js"></script>
<script src="/static/js/viewer.js"></script>
<script src="/static/js/auth.js"></script>
<script src="/static/js/app.js"></script>
</body>
</html>
