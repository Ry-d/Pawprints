<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>PawPrints â€” Turn Your Pet Into a Keepsake</title>
    <meta name="description" content="Upload a photo of your pet and we'll turn them into a beautiful 3D-printed keepsake. Statues and keyrings.">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="/static/css/style.css">
    <!-- Firebase -->
    <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-auth-compat.js"></script>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/loaders/GLTFLoader.js"></script>
</head>
<body>

<!-- Nav -->
<nav class="nav">
    <div class="nav-left">
        <button class="nav-back" id="nav-back" onclick="goBack()" style="display:none;">â†</button>
        <a href="/" class="nav-logo">ğŸ¾ <span>Paw</span>Prints</a>
    </div>
    <div class="nav-right">
        <div class="nav-step" id="nav-step">Step 1 of 6</div>
        <div id="nav-auth"><button class="btn-sign-in" onclick="showSignIn()">Sign In</button></div>
    </div>
</nav>

<!-- Auth Modal -->
<div class="auth-modal" id="auth-modal">
    <div class="auth-card">
        <button class="auth-close" onclick="hideSignIn()">âœ•</button>
        <div class="auth-logo">ğŸ¾</div>
        <h2>Sign in to PawPrints</h2>
        <p>Save your keepsakes, track orders, and earn credits.</p>
        <button class="btn btn-google" onclick="signInWithGoogle()">
            <svg width="18" height="18" viewBox="0 0 18 18"><path fill="#4285F4" d="M17.64 9.2c0-.637-.057-1.251-.164-1.84H9v3.481h4.844c-.209 1.125-.843 2.078-1.796 2.717v2.258h2.908c1.702-1.567 2.684-3.875 2.684-6.615z"/><path fill="#34A853" d="M9 18c2.43 0 4.467-.806 5.956-2.18l-2.908-2.259c-.806.54-1.837.86-3.048.86-2.344 0-4.328-1.584-5.036-3.711H.957v2.332A8.997 8.997 0 0 0 9 18z"/><path fill="#FBBC05" d="M3.964 10.71A5.41 5.41 0 0 1 3.682 9c0-.593.102-1.17.282-1.71V4.958H.957A8.997 8.997 0 0 0 0 9c0 1.452.348 2.827.957 4.042l3.007-2.332z"/><path fill="#EA4335" d="M9 3.58c1.321 0 2.508.454 3.44 1.345l2.582-2.58C13.463.891 11.426 0 9 0A8.997 8.997 0 0 0 .957 4.958L3.964 7.29C4.672 5.163 6.656 3.58 9 3.58z"/></svg>
            Continue with Google
        </button>
        <div class="auth-divider"><span>coming soon</span></div>
        <button class="btn btn-secondary" disabled style="opacity:0.4;">Continue with Facebook</button>
        <button class="btn btn-secondary" disabled style="margin-top:8px;opacity:0.4;">Continue with X</button>
        <div class="auth-terms">By signing in you agree to our Terms of Service and Privacy Policy.</div>
    </div>
</div>

<!-- User Portal -->
<div class="portal-overlay" id="screen-portal">
    <div class="portal-panel">
        <div class="portal-header">
            <h2>My Account</h2>
            <button class="auth-close" onclick="hidePortal()">âœ•</button>
        </div>
        <div class="portal-user">
            <div class="portal-avatar" id="portal-avatar">ğŸ‘¤</div>
            <div><div class="portal-name" id="portal-name"></div><div class="portal-email" id="portal-email"></div></div>
        </div>

        <!-- Credits -->
        <div class="config-card">
            <h3>âš¡ Credits</h3>
            <div class="credits-display"><span class="credits-count" id="portal-credits">3</span><span class="credits-label">3D generations remaining</span></div>
            <button class="btn btn-primary btn-sm" onclick="alert('Stripe checkout coming soon!')" style="margin-top:10px;">Buy More Credits</button>
        </div>

        <!-- Saved Pets / Models -->
        <div class="config-card">
            <h3>ğŸ¾ My Pets</h3>
            <div id="portal-models"><div class="empty-state">No saved pets yet â€” create your first keepsake!</div></div>
        </div>

        <!-- Order History -->
        <div class="config-card">
            <h3>ğŸ“‹ Orders</h3>
            <div id="portal-orders"><div class="empty-state">No orders yet</div></div>
        </div>

        <!-- Shipping (collapsible) -->
        <div class="config-card">
            <h3 class="collapsible-header" onclick="toggleCollapsible('shipping-details')">ğŸ“¦ Shipping Details <span class="collapse-arrow" id="shipping-details-arrow">â–¸</span></h3>
            <div class="collapsible-content" id="shipping-details" style="display:none;">
                <div class="form-group"><label>Phone</label><input type="tel" id="profile-phone" placeholder="+61 400 000 000"></div>
                <div class="form-group"><label>Street Address</label><input type="text" id="profile-address" placeholder="123 Main Street"></div>
                <div class="form-row"><div class="form-group"><label>City</label><input type="text" id="profile-city" placeholder="Sydney"></div><div class="form-group"><label>State</label><input type="text" id="profile-state" placeholder="NSW"></div></div>
                <div class="form-row"><div class="form-group"><label>Postcode</label><input type="text" id="profile-postcode" placeholder="2000"></div><div class="form-group"><label>Country</label><select id="profile-country"><option value="AU" selected>Australia</option><option value="US">United States</option><option value="UK">United Kingdom</option><option value="NZ">New Zealand</option><option value="CA">Canada</option></select></div></div>
                <div class="form-group" style="margin-top:12px;"><label class="checkbox-label"><input type="checkbox" id="profile-marketing"> Send me updates about new products and offers</label></div>
                <button class="btn btn-accent btn-sm" onclick="saveUserProfile()" style="margin-top:12px;">Save Details</button>
            </div>
        </div>

        <button class="btn btn-secondary" onclick="signOut()" style="margin-top:16px;">Sign Out</button>
    </div>
</div>

<!-- Step Dots -->
<div class="steps">
    <div class="step-dot active"></div>
    <div class="step-dot"></div>
    <div class="step-dot"></div>
    <div class="step-dot"></div>
    <div class="step-dot"></div>
    <div class="step-dot"></div>
</div>

<div class="container">

    <!-- â•â• SCREEN 1: Upload Photo â•â• -->
    <div class="screen active" id="screen-upload">
        <div class="hero">
            <h1>Turn your pet into<br>a keepsake</h1>
            <p>Upload or take a photo of your furry friend to get started</p>
        </div>

        <div class="upload-card">
            <div class="upload-inner">
                <div class="upload-prompt" id="upload-prompt-area">
                    <span class="upload-icon">ğŸ“¸</span>
                    <span>Upload or take a photo of your pet</span>
                </div>
                <div class="upload-btns">
                    <button class="btn btn-primary btn-sm" onclick="triggerCamera()">ğŸ“· Camera</button>
                    <button class="btn btn-secondary btn-sm" onclick="triggerGallery()">ğŸ–¼ï¸ Gallery</button>
                </div>
                <div class="upload-preview" id="upload-preview" style="display:none;">
                    <img id="upload-preview-img" alt="Pet photo">
                    <button class="preview-remove" onclick="removePhoto()">âœ•</button>
                </div>
            </div>
        </div>

        <input type="file" id="file-input" accept="image/*" hidden>
        <input type="file" id="camera-input" accept="image/*" capture="environment" hidden>

        <button class="btn btn-accent btn-lg" id="btn-continue-upload" onclick="goToProduct()" disabled>
            Continue â†’
        </button>
        <div class="secure-badge">ğŸ”’ Your photos are processed securely</div>

        <a href="#" class="example-link">â†’ View example photos</a>

        <footer class="footer">
            ğŸ¾ PawPrints Â· Handcrafted in Australia
        </footer>
    </div>

    <!-- â•â• SCREEN 2: Product Selection â•â• -->
    <div class="screen" id="screen-product">
        <div class="hero">
            <h1>Choose your keepsake</h1>
            <p>Select the type of keepsake you'd like</p>
        </div>

        <!-- Pet photo preview -->
        <div class="product-pet-preview">
            <img id="product-pet-img" alt="Your pet">
        </div>

        <!-- Statue Card -->
        <div class="product-card" id="card-statue" onclick="selectProduct('statue')">
            <div class="product-card-header">
                <div>
                    <div class="product-card-title">Statue</div>
                    <div class="product-card-desc">Keepsake statue for display</div>
                </div>
                <div class="product-card-icon">ğŸ—¿</div>
            </div>
        </div>

        <!-- Keyring Card -->
        <div class="product-card" id="card-keyring" onclick="selectProduct('keyring')">
            <div class="product-card-header">
                <div>
                    <div class="product-card-title">Keyring</div>
                    <div class="product-card-desc">Mini charm keychain</div>
                </div>
                <div class="product-card-icon">ğŸ”‘</div>
            </div>
        </div>

        <button class="btn btn-accent btn-lg" id="btn-continue-product" onclick="goToSignInThenMaterial()" disabled>
            Continue â†’
        </button>

        <button class="btn btn-secondary" onclick="showScreen('upload')" style="margin-top:10px;">
            â† Change Photo
        </button>
    </div>

    <!-- â•â• SCREEN 3: Material Preview â•â• -->
    <div class="screen" id="screen-material">
        <div class="hero">
            <h1>Choose your material</h1>
            <p>Reroll for free until you're happy. Bank your favourite to keep it safe.</p>
        </div>

        <!-- Banked image (Tetris hold style) -->
        <div class="banked-float material-banked" id="material-banked-section" style="display:none;" onclick="swapBankedMaterial()">
            <div class="banked-float-label">â­ HOLD</div>
            <img id="material-banked-img" alt="Banked preview">
        </div>

        <!-- Large preview image -->
        <div class="material-main-preview">
            <img id="material-main-img" alt="Material preview">
        </div>

        <!-- Thumbnail row: original + bronze + resin -->
        <div class="material-thumbs" id="material-thumbs">
            <!-- Populated dynamically -->
        </div>

        <!-- Reroll buttons -->
        <div class="material-reroll-actions">
            <button class="btn btn-secondary btn-sm" id="btn-reroll-bronze" onclick="rerollMaterialPreview('bronze')">ğŸ”„ Reroll Bronze</button>
            <button class="btn btn-secondary btn-sm" id="btn-reroll-resin" onclick="rerollMaterialPreview('resin')">ğŸ”„ Reroll Resin</button>
            <button class="btn btn-primary btn-sm" id="btn-bank-material" onclick="bankCurrentMaterial()">â­ Bank this one</button>
        </div>

        <!-- Material choice buttons -->
        <div class="material-choice-buttons">
            <button class="btn btn-primary btn-lg material-choose-btn" id="btn-choose-bronze" onclick="chooseMaterial('bronze')">
                ğŸ¥‰ Choose Bronze
            </button>
            <button class="btn btn-primary btn-lg material-choose-btn" id="btn-choose-resin" onclick="chooseMaterial('resin')">
                ğŸ¨ Choose Full Colour Resin
            </button>
        </div>

        <button class="btn btn-secondary" onclick="showScreen('product')" style="margin-top:10px;">
            â† Back to Product
        </button>

        <div class="secure-badge" style="margin-top:12px;">Rerolls are free â€” get it looking right</div>
    </div>

    <!-- â•â• SCREEN 4: Multi-View Review â•â• -->
    <div class="screen" id="screen-multiview">
        <div class="hero">
            <h1>Multi-View Preview</h1>
            <p>Review front, side, and back views of your <span id="multiview-material-label">bronze</span> keepsake</p>
        </div>

        <div class="multiview-grid" id="multiview-grid">
            <!-- Populated dynamically -->
        </div>

        <!-- Confirmation checkboxes -->
        <div class="config-card multiview-confirmations" id="multiview-confirmations">
            <h3>âœ… Confirm before generating</h3>
            <label class="checkbox-label" id="eyelet-check-label" style="display:none;">
                <input type="checkbox" id="check-eyelet" onchange="checkMultiviewReady()">
                Eyelet is visible and firmly anchored
            </label>
            <label class="checkbox-label">
                <input type="checkbox" id="check-resemblance" onchange="checkMultiviewReady()">
                Strong resemblance to my pet
            </label>
        </div>

        <button class="btn btn-accent btn-lg" id="btn-confirm-multiview" onclick="showConfirmModal()" disabled>
            âœ… Generate 3D Model
        </button>

        <button class="btn btn-secondary" onclick="rerollMultiview()" style="margin-top:10px;">
            ğŸ”„ Regenerate Views (free)
        </button>

        <button class="btn btn-secondary" onclick="showScreen('material')" style="margin-top:10px;">
            â† Back to Material
        </button>
    </div>

    <!-- â•â• SCREEN 5: Generating (3D model + testimonials) â•â• -->
    <div class="screen" id="screen-generating">
        <div class="hero">
            <h1>Creating your 3D model</h1>
            <p>This usually takes 2-4 minutes. Check out what others have made while you wait!</p>
        </div>

        <div class="generating-progress">
            <div class="spinner"></div>
            <div class="generating-status" id="generating-status">Starting generation...</div>
            <div class="progress-bar"><div class="progress-fill" id="generating-progress-fill"></div></div>
        </div>

        <!-- Testimonials / Social Proof -->
        <div class="testimonials-section">
            <h3>ğŸ’¬ What our customers say</h3>

            <div class="testimonial-card">
                <div class="testimonial-stars">â­â­â­â­â­</div>
                <p class="testimonial-text">"The bronze statue of my golden retriever is absolutely stunning. It captures every detail â€” even the way he tilts his head!"</p>
                <div class="testimonial-author">
                    <div class="testimonial-avatar">ğŸ•</div>
                    <div>
                        <div class="testimonial-name">Sarah M.</div>
                        <div class="testimonial-product">Bronze Statue Â· Golden Retriever</div>
                    </div>
                </div>
            </div>

            <div class="testimonial-card">
                <div class="testimonial-stars">â­â­â­â­â­</div>
                <p class="testimonial-text">"I carry my cat everywhere now! The keyring is so detailed and the bronze finish is beautiful. Perfect memorial for my Whiskers."</p>
                <div class="testimonial-author">
                    <div class="testimonial-avatar">ğŸˆ</div>
                    <div>
                        <div class="testimonial-name">James K.</div>
                        <div class="testimonial-product">Bronze Keyring Â· Tabby Cat</div>
                    </div>
                </div>
            </div>

            <div class="testimonial-card">
                <div class="testimonial-stars">â­â­â­â­â­</div>
                <p class="testimonial-text">"The full-color resin statue looks exactly like my Frenchie! The colors are vibrant and it's now pride of place on my desk."</p>
                <div class="testimonial-author">
                    <div class="testimonial-avatar">ğŸ¾</div>
                    <div>
                        <div class="testimonial-name">Emma L.</div>
                        <div class="testimonial-product">Resin Statue Â· French Bulldog</div>
                    </div>
                </div>
            </div>

            <div class="testimonial-card">
                <div class="testimonial-stars">â­â­â­â­â­</div>
                <p class="testimonial-text">"Ordered as a gift for my mum â€” she cried happy tears. The detail on the resin keyring is incredible for something so small."</p>
                <div class="testimonial-author">
                    <div class="testimonial-avatar">ğŸ¶</div>
                    <div>
                        <div class="testimonial-name">Tom R.</div>
                        <div class="testimonial-product">Resin Keyring Â· Cavoodle</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Gallery of example products -->
        <div class="social-proof-gallery">
            <h3>ğŸ“¸ Recent creations</h3>
            <div class="gallery-grid">
                <div class="gallery-item">
                    <div class="gallery-placeholder">ğŸ• Bronze Statue</div>
                </div>
                <div class="gallery-item">
                    <div class="gallery-placeholder">ğŸˆ Resin Keyring</div>
                </div>
                <div class="gallery-item">
                    <div class="gallery-placeholder">ğŸ¾ Bronze Keyring</div>
                </div>
                <div class="gallery-item">
                    <div class="gallery-placeholder">ğŸ¦® Resin Statue</div>
                </div>
            </div>
        </div>
    </div>

    <!-- â•â• SCREEN 6: Customise â•â• -->
    <div class="screen" id="screen-customise">

        <!-- Product Label -->
        <div class="product-label" id="product-label">ğŸ—¿ Statue</div>

        <!-- Material badge -->
        <div class="material-badge" id="material-badge">Material: Bronze</div>

        <!-- 3D Viewer -->
        <div class="viewer-container" id="viewer-3d">
            <button class="viewer-reset" onclick="resetView()">Reset view</button>
            <button class="viewer-reroll" id="btn-reroll" onclick="rerollModel()">ğŸ”„ Regenerate (<span id="reroll-count">2</span> left)</button>
            <div class="viewer-hint">Drag to rotate Â· Pinch to zoom</div>
        </div>

        <!-- Size (statue only) -->
        <div class="config-card" id="size-card">
            <h3>âœ¦ Size <span class="size-badge" id="size-badge">150mm</span></h3>
            <div class="size-presets" id="size-presets">
                <button class="preset-btn" data-size="100" onclick="setPreset(100)">Small<br><span>100mm</span></button>
                <button class="preset-btn active" data-size="150" onclick="setPreset(150)">Medium<br><span>150mm</span></button>
                <button class="preset-btn" data-size="260" onclick="setPreset(260)">Large<br><span>260mm</span></button>
            </div>
            <div class="size-control">
                <input type="range" id="size-slider" min="50" max="300" value="150" step="5">
                <div class="size-limits">
                    <span id="size-min-label">50mm</span>
                    <span id="size-max-label">300mm</span>
                </div>
                <div class="size-warning" id="size-warning"></div>
            </div>
        </div>

        <button class="btn btn-accent btn-lg" id="btn-order" onclick="goToOrder()">
            Continue â†’
        </button>
        <div class="secure-badge">ğŸ”’ Secure checkout</div>
    </div>

    <!-- â•â• SCREEN 7: Order Review â•â• -->
    <div class="screen" id="screen-order">
        <div class="hero">
            <h1>Review Your Order</h1>
        </div>

        <!-- Captured 3D preview -->
        <div class="order-preview">
            <img id="order-preview-img" alt="Your configured keepsake">
        </div>

        <div class="quote-card">
            <div class="quote-label">Total price</div>
            <div class="quote-price" id="order-total-price">$124.06 AUD</div>
        </div>

        <div class="success-card" id="order-summary">
            <div class="row">
                <span class="label">Product</span>
                <span class="value" id="order-product">Statue</span>
            </div>
            <div class="row">
                <span class="label">Material</span>
                <span class="value" id="order-material">Bronze</span>
            </div>
            <div class="row" id="order-size-row">
                <span class="label">Size</span>
                <span class="value" id="order-size">150mm</span>
            </div>
            <div class="row">
                <span class="label">Lead Time</span>
                <span class="value" id="order-lead-time">3-4 weeks</span>
            </div>
        </div>

        <!-- Lead time note -->
        <div class="lead-time-note" id="lead-time-note">
            <strong>ğŸ“¦ Estimated lead times:</strong><br>
            Bronze: 3-4 weeks Â· Full Colour Resin: 1-2 weeks
        </div>

        <button class="btn btn-accent btn-lg" onclick="placeOrder()">
            ğŸ›’ Place Order
        </button>
        <div class="secure-badge">ğŸ”’ Secure checkout</div>

        <button class="btn btn-secondary" onclick="showScreen('customise')" style="margin-top:10px;">
            â† Back to Customise
        </button>
    </div>

    <!-- â•â• SCREEN 8: Success â•â• -->
    <div class="screen" id="screen-success">
        <div class="success-icon">ğŸ‰</div>
        <div class="hero">
            <h1>Order Placed!</h1>
            <p>We'll start crafting your keepsake right away. You'll receive updates via email.</p>
        </div>

        <div class="success-card">
            <div class="row">
                <span class="label">Order ID</span>
                <span class="value" id="success-order-id">PP-XXXX</span>
            </div>
            <div class="row">
                <span class="label">Status</span>
                <span class="value">Processing</span>
            </div>
            <div class="row">
                <span class="label">Est. Delivery</span>
                <span class="value" id="success-delivery">2-3 weeks</span>
            </div>
        </div>

        <!-- Social Sharing -->
        <div class="config-card">
            <h3>ğŸ“£ Share the love!</h3>
            <p style="font-size:13px;color:var(--text-muted);margin-bottom:12px;">Show off your new keepsake</p>
            <div class="share-buttons">
                <button class="share-btn share-fb" onclick="shareTo('facebook')">Facebook</button>
                <button class="share-btn share-x" onclick="shareTo('x')">ğ•</button>
                <button class="share-btn share-wa" onclick="shareTo('whatsapp')">WhatsApp</button>
                <button class="share-btn share-copy" onclick="copyShareLink()">ğŸ“‹ Copy Link</button>
            </div>
        </div>

        <button class="btn btn-primary btn-lg" onclick="location.reload()">
            Create Another Keepsake
        </button>
    </div>

</div>

<!-- Footer with Socials -->
<footer class="footer">
    <div class="footer-brand">ğŸ¾ PawPrints Â· Handcrafted in Australia</div>
    <div class="footer-socials">
        <a href="https://instagram.com/pawprints" target="_blank" class="social-link">Instagram</a>
        <a href="https://facebook.com/pawprints" target="_blank" class="social-link">Facebook</a>
        <a href="https://x.com/pawprints" target="_blank" class="social-link">ğ•</a>
        <a href="https://tiktok.com/@pawprints" target="_blank" class="social-link">TikTok</a>
    </div>
    <div class="footer-links">
        <a href="#">Terms</a> Â· <a href="#">Privacy</a> Â· <a href="#">Contact</a>
    </div>
</footer>

<!-- Confirm Generate Modal -->
<div class="auth-modal" id="confirm-modal">
    <div class="auth-card">
        <button class="auth-close" onclick="hideConfirmModal()">âœ•</button>
        <h2>Generate 3D Model?</h2>
        <p style="margin-bottom:16px;">This will create your 3D model using 1 credit.</p>
        <div class="confirm-preview">
            <img id="confirm-img" alt="Image to generate" style="width:100%;max-height:40vh;object-fit:contain;border-radius:12px;">
        </div>
        <button class="btn btn-accent btn-lg" onclick="confirmGenerate()" style="margin-top:16px;">âœ… Yes, generate</button>
        <button class="btn btn-secondary" onclick="hideConfirmModal()" style="margin-top:8px;">Cancel</button>
    </div>
</div>

<!-- Processing Overlay -->
<div class="processing-overlay" id="processing-overlay">
    <div class="spinner"></div>
    <div class="processing-text" id="processing-text">Processing your photo...</div>
    <div class="processing-sub" id="processing-sub">This usually takes a moment</div>
    <div class="progress-bar"><div class="progress-fill" id="progress-fill"></div></div>
</div>

<script src="/static/js/materials.js"></script>
<script src="/static/js/viewer.js"></script>
<script src="/static/js/auth.js"></script>
<script src="/static/js/app.js"></script>
</body>
</html>
